{% extends 'base.html' %}
{% block content %}

<h1>Animal Detail</h1>

<div class="card">
  <div class="card-content">
    <div class="flex-container"> 
       <div>
          <span class="card-title">{{ animal.animal }}</span>
          <p>Breed: {{ animal.eat }}</p>
          <p>Description: {{ animal.description }}</p>
          <p>{{ animal.age }}</p>

          <div class="card-action">
            <a href="{% url 'animals_update' animal.id %}">Edit</a>
            <a href="{% url 'animals_delete' animal.id %}">Delete</a>
          </div>
        </div>

        <div>
          {% load static %}
          <img width="100px" height="100px" src="{% static animal.image.url %}" alt="{{ animal.animal }}" />
        </div>
    </div>
  </div>
</div>

<div>
  <form method="post" action="{% url 'add_feeding' animal.id %}">
    {% csrf_token %}
    {{ feeding_form.as_p }}
    <input type="submit" class="btn" value="Add Feeding">
  </form>

  {% if animal.fed_for_today %}
  <div class="card-panel teal-text center-align">{{ animal.animal }} has been fed for all meals today</div>
  {% else %}
  <div class="card-panel red-text center-align">{{ animal.animal }} is underfed today</div>
  {% endif %}

  <table class="striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Meal</th>
      </tr>
    </thead>

    <tbody>
      {% for feeding in animal.feeding_set.all %}
      <tr>
        <td>{{ feeding.date }}</td>
        <td>{{ feeding.get_meal_display }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="row">
  <div class="col s6">
    <h3>
      {% if animal.toys.count %}
        {{ animal.animal }}'s Toys
        {% for toy in animal.toys.all %}
          <div class="card">
            <div class="card-content">
              <span class="card-title">
                <span style="color: {{ toy.color }}">{{ toy.color }}</span> {{ toy.name }}
              </span>
            </div>
            <div class="card-action">
              <form action="{% url 'unassoc_toy' animal.id toy.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn">Remove</button>
              </form>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <h5>No Toys :(</h5>
      {% endif %}
    </h3>
  </div>

  <div class="col s6">
    <h3>Available Toys</h3>
    {% if toys.count %}
      {% for toy in toys.all %}
        <div class="card">
          <div class="card-content">
            <span class="card-title">
              A <span style="color: {{ toy.color }}">{{ toy.color }}</span> {{ toy.name }}
            </span>
          </div>
          <div class="card-action">
            <form action="{% url 'assoc_toy' animal.id toy.id %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn">Add</button>
            </form>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <h5>{{ animal.animal }} already has all the toys available</h5>
    {% endif %}
  </div>
</div>

<script>
  let dateElement = document.getElementById('id_date');
  M.Datepicker.init(dateElement, { format: 'yyyy-mm-dd', defaultDate: new Date(), setDefaultDate: true, autoClose: true });

  let mealEl = document.getElementById('id_meal');
  M.FormSelect.init(mealEl, {});
</script>

{% endblock %}